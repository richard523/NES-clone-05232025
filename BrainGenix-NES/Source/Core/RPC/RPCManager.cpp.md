## Inputs

The `RPCManager` class is initialized with:
*   `_Config` (Config::Config\*): Pointer to the application's configuration struct, used to get host and port for the RPC server.
*   `_Logger` (BG::Common::Logger::LoggingSystem\*): Pointer to the logging system.

Its methods receive inputs primarily as JSON strings for RPC requests:
*   `NESRequest`: Takes a JSON string representing an array of individual commands, each with a `ReqID` and command-specific parameters.
*   `SetupCallback`: Takes a JSON string with `CallbackHost` and `CallbackPort`.
*   Registered route handlers (via `AddRoute`) receive a JSON string specific to their defined interface.

## Outputs

The `RPCManager`'s methods and the handlers it manages produce:
*   JSON string responses to RPC clients. For `NESRequest`, this is an array of responses.
*   The RPC server listens on a network port, making the API accessible.
*   The `MakeAPIQuery` method sends requests to an external API service and returns its response via an out-parameter.
*   Background task IDs are generated by `GetBgRequestID()`.

## Description

The `RPCManager.cpp` file, along with its header `RPCManager.h`, defines the central component for handling Remote Procedure Calls (RPC) in the BrainGenix-NES system. It initializes and manages an RPC server (from `rpclib`), allowing clients to interact with the application remotely. The `RPCManager` provides mechanisms for other modules to register their specific RPC routes and handler functions. It features a generic `NESRequest` endpoint that can process batches of commands, dispatching each to its appropriate handler. It also includes functionality to configure and make calls to an upstream API service.

## ASCII Diagram

```
+----------------------------------------------------+
|  RPCManager                                        |
+----------------------------------------------------+
| - Config_: Config*                                 |
| - RPCServer_: unique_ptr<rpc::server>              |
| - Logger_: LoggingSystem*                          |
| - APIClient_: unique_ptr<SafeClient>               |
| - RequestHandlers_: map<string, function>          |
| - BgRequestID: long                                |
| - BgStatusResultMap: map<long, json*>              |
+----------------------------------------------------+
| + RPCManager(_Config*, _Logger*)                   | // Initializes and starts RPCServer_
| + ~RPCManager()                                    |
| + GetBgRequestID(): long                           |
| + RegisterBgAPIProcess(long, json*)                |
| + UnRegisterBgAPIProcess(long): bool               |
| + SetupCallback(_JSONRequest): string              | // Configures APIClient_
| + AddRoute(_RouteHandle, _Function)                | // For dynamic handlers (used by NESRequest)
| + MakeAPIQuery(_Path, _Query, &_Result): bool      |
| + NESRequest(_JSONRequest, _SimIDOverride): string | // Batch request handler
| + AddRoute<F>(_RouteName, _Logger, _Callback)      | // Template for static rpclib routes
+----------------------------------------------------+
        |                                  ^
        | Manages                          | Dispatches to
        v                                  |
+--------------------------------------+   +-----------------------------------------+
| rpc::server (from rpclib)            |   | Registered Handler Functions            |
| (Listens for client connections)     |   | (e.g., from SimulationRPCInterface etc.)|
+--------------------------------------+   +-----------------------------------------+
```
